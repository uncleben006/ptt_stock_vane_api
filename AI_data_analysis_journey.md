## AI 分析資料心路歷程

本專案的目的是要辨識出 PTT 股票版中每則留言所提到的 **公司** 以及留言對於市場的 **情緒分數**。

首先，要想辨識出留言當中的股票，我先後嘗試了幾種方法

1. 做一個股票字典，將所有股票代碼、名稱、簡稱、綽號 都列出來，只要留言提到，就代表留言在指涉特定公司。
   >實際測試後發現這個方式有明顯缺點，因為留言太雜，提及公司時綽號太多<br>
   >撇開綽號不談有些股票名也很容易與一般文字混淆，例如 **世界**、**綠電**、**材料** 等等

2. NER 命名實體識別：用 NER 模型(Spacy)來判斷留言中的詞彙組成，是否有機構、組織之類的詞性，再與第一點的股票字典做 mapping，有匹配就代表留言在指涉特定公司。
   >這個方法理論上可行，但我選用的Spacy模型有時判斷不準確，例如這則留言「長榮送分題300起 陽明100 順勢抱緊加碼」<br>
   >Spacy 應該要將「長榮」判斷成 ORG，但實際上只有判斷出「300起 QUANTITY」「陽明 ORG」<br>
   >再加上就算詞性判斷正確了，還要再匹配股票字典，許多明明有指涉公司的留言會因此沒有被判斷到<br>
   >因此決定嘗試其他方法，真的不行再回過頭來微調 Spacy

3. RAG 架構：將股票字典轉成 Embedding，再辨識留言中的股票時，先將留言文字轉向量並與向量資料庫比對，取最相似的資料再一齊詢問 GPT，讓 GPT 判斷留言是否在指涉特定公司。
   >經過測試發現用留言去比對股票字典時常會有誤判，大概是因為留言中雜訊太多，<br>
   >我們人關注的是股票名稱或綽號，但 cosine similarity 會受到其他文字的影響。<br>
   >例如這則留言「GG九月不是有除息行情 怎麼」，<br>
   >照理說留言提到「GG」應該要匹配字典中的「台積電」的綽號，<br>
   >應該要辨識出「台積電」才對，但卻是以下(最相近五名)<br>
   >```
   >no: 890B
   >name: 凱基ESGBBB債15+
   >score: 0.41803676
   >no: 00890B
   >name: 凱基ESGBBB債15+
   >score: 0.41031525
   >no: 874B
   >name: 凱基BBB公司債15+
   >score: 0.4020667
   >no: 00779B
   >name: 凱基美債25+
   >score: 0.39041612
   >no: 00874B
   >name: 凱基BBB公司債15+
   >score: 0.39025843 
   >```
   >而這則留言「3715不翻黑是吧 來補一補」，
   >應該匹配到字典中的 3715 也就是「定穎投控」，
   >但卻是以下結果(最相近五名)
   >```
   >no: 3028
   >name: 增你強
   >score: 0.39106822
   >no: 3015
   >name: 全漢
   >score: 0.38480386
   >no: 6625
   >name: 必應
   >score: 0.38193548
   >no: 4155
   >name: 訊映
   >score: 0.38128218
   >no: 6015
   >name: 宏遠證
   >score: 0.37946245
   >```

4. 先將留言切詞，用編輯距離(萊文斯特距離)去比對股票字典，將比對後的結果放入 GPT 做最終判斷
   >這個方法理論上是可行，但就是 GPT-3.5 太笨了，<br>
   >只要是有匹配到字典的詞彙，請 GPT-3.5 做最終判斷，不管對錯 GPT-3.5 都會採納當成留言有提到股票...<br>
   >例如「推，那個網站第一次見感覺之後能用」這句留言會匹配到[第一銅:2009]，<br>
   >因為[第一]跟[第一銅]高達 66.67% 相似(編輯距離很短)，<br>
   >明眼人一看就知道該留言沒有提到「第一銅」，但 GPT-3.5 就是認為他有提到。<br>
   >類似案例還有很多，族繁不及備載。<br>

5. 七月(2024年)時若想使用 GPT-4 實在太貴了，黔驢技窮的情況下我只能寫 selenium 透過瀏覽器自動化向 GPT-4 詢問每則留言。
   >成效還不錯，公司名稱以及市場情緒分數都有滿高的正確率，但就是速度太慢了，<br>
   >實測後大約分析完250~300句留言就會達到 rate limit，下一次再等 3 小時，<br>
   >時間成本巨大的情況下，我決定只提取 8/1 到 8/7 的留言做分析，<br>
   >因為當時台股有股災可以很好的比較留言市場情緒與真實股市是否有關係。

   <video controls>
      <source src="./selenium.mov" type="video/mp4">
      Your browser does not support the video tag.
   </video>